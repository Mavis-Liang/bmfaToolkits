<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Demonstration and example usage of bmfaToolkits • bmfaToolkits</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Demonstration and example usage of bmfaToolkits">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bmfaToolkits</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/toy_workflows.html">Demonstration and example usage of bmfaToolkits</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Mavis-Liang/bmfaToolkits/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Demonstration and example usage of bmfaToolkits</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Mavis-Liang/bmfaToolkits/blob/main/vignettes/toy_workflows.Rmd" class="external-link"><code>vignettes/toy_workflows.Rmd</code></a></small>
      <div class="d-none name"><code>toy_workflows.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="install-load">0. Install / load<a class="anchor" aria-label="anchor" href="#install-load"></a>
</h3>
<p>Many methods are implemented in <strong>optional backends</strong>
(GitHub/Bioconductor packages, or bundled scripts).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="co"># remotes::install_github("Mavis-Liang/bmfaToolkits")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Mavis-Liang/bmfaToolkits" class="external-link">bmfaToolkits</a></span><span class="op">)</span></span></code></pre></div>
<p>Check what you can run on your machine:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/available_backends.html">available_backends</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If you need an optional backend (and it is unavailable above),
install it via:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/install_backend.html">install_backend</a></span><span class="op">(</span><span class="st">"bmsfa"</span><span class="op">)</span>        <span class="co"># installs MSFA from GitHub</span></span>
<span><span class="fu"><a href="../reference/install_backend.html">install_backend</a></span><span class="op">(</span><span class="st">"momss"</span><span class="op">)</span>        <span class="co"># installs BFR.BE + Bioc deps</span></span>
<span><span class="fu"><a href="../reference/install_backend.html">install_backend</a></span><span class="op">(</span><span class="st">"sufa"</span><span class="op">)</span>         <span class="co"># installs SUFA from GitHub (build_vignettes = FALSE)</span></span>
<span><span class="fu"><a href="../reference/install_backend.html">install_backend</a></span><span class="op">(</span><span class="st">"curated_ovarian"</span><span class="op">)</span></span></code></pre></div>
<p>and no need t <code>library</code> it after installing.</p>
<blockquote>
<p><strong>Note on MOM-SS/BFR.BE.</strong> We only support MOM-SS in
“BFR.BE” backend right now. If you want to run other method mentioned in
their paper, eg. Laplace-SS, please refer to their original
repository.</p>
</blockquote>
<blockquote>
<p><strong>Note on SUFA.</strong><br>
You need to install PROJ, sqlite3 and GDAL onto PATH. Several updates
should be done, for example, terra. These might be difficult.</p>
</blockquote>
<blockquote>
<p><strong>Note on BMSFA</strong> install_backend(“bmsfa”) installs the
MSFA package from Mavis’s GitHub, which allows user-input scaling and
centering options. The DeVito MSFA package does not have these options
and does internal standardizations. If your backend is DeVito’s MSFA, do
not specify scaling/centering.</p>
</blockquote>
<blockquote>
<p><strong>Note on script backends (PFA / Tetris).</strong><br>
In this package, PFA and Tetris are bundled under
<code>inst/extdata/pfa/</code> and
<code>inst/extdata/tetris/</code>.<br>
They are loaded on demand via <code>load_backend("pfa")</code> or
<code>load_backend("tetris")</code>. PFA may compile
<code>PFA.cpp</code>, which requires a working C++ toolchain.</p>
</blockquote>
<p><strong>If install_backend function does not work, you can always
install them yourself then run the bmfaToolkits package.</strong></p>
</div>
<div class="section level3">
<h3 id="load-toy-data-shipped-in-the-package">1. Load toy data (shipped in the package)<a class="anchor" aria-label="anchor" href="#load-toy-data-shipped-in-the-package"></a>
</h3>
<p>We demonstrate the workflows using a toy simulated data with
<code>S = 3</code> studies and <code>P = 20</code> variables.</p>
<p>The toy data live in <code>inst/extdata/toy.rds</code>. We can load
it using <code><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">toy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"toy.rds"</span>, package <span class="op">=</span> <span class="st">"bmfaToolkits"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">toy</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The package wrappers expect <code>Y_list</code>: a list of study
matrices with the same number of columns (variables).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Y_list</span> <span class="op">&lt;-</span> <span class="va">toy</span><span class="op">$</span><span class="va">Y_list</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y_list</span><span class="op">)</span></span>
<span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="va">S</span>, P <span class="op">=</span> <span class="va">P</span><span class="op">)</span></span></code></pre></div>
<p>Throughout this vignette: - <code>S</code> = number of studies -
<code>P</code> = number of variables</p>
</div>
<div class="section level3">
<h3 id="common-post-processing-outputs">2. Common post-processing outputs<a class="anchor" aria-label="anchor" href="#common-post-processing-outputs"></a>
</h3>
<p>Each <code>postprocess_*()</code> function returns a list of
covariance components used in the tutorial:</p>
<ul>
<li>
<code>Phi</code> / <code>SigmaPhi</code>: shared loadings / shared
covariance</li>
<li>
<code>LambdaList</code> / <code>SigmaLambdaList</code>:
study-specific loadings / covariances (if the method has them)</li>
<li>
<code>Psi</code> or <code>PsiList</code>: diagonal residual
variances</li>
<li>
<code>SigmaMarginal</code>: per-study marginal covariance (shared +
specific + residual)</li>
</ul>
<p>The selection helpers choose dimensions using an <strong>eigenvalue
proportion rule</strong> (see <code><a href="../reference/select_k_from_sigma.html">select_k_from_sigma()</a></code>), and
the <code>refit_*()</code> helpers wrap the “initial fit → select dims →
refit” workflow.</p>
<hr>
</div>
<div class="section level2">
<h2 id="method-a-stack-fa-msfa-backend">Method A: Stack FA (MSFA backend)<a class="anchor" aria-label="anchor" href="#method-a-stack-fa-msfa-backend"></a>
</h2>
<p>“Stack FA” stacks all studies and fits a single factor model.</p>
<div class="section level3">
<h3 id="a1--fit">A1. Fit<a class="anchor" aria-label="anchor" href="#a1--fit"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_stack_fa.html">fit_stack_fa</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>, <span class="co"># Overspecified</span></span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a2--post-process">A2. Post-process<a class="anchor" aria-label="anchor" href="#a2--post-process"></a>
</h3>
<p><code><a href="../reference/postprocess_stack_fa.html">postprocess_stack_fa()</a></code> takes <code>S</code> so it can
return a per-study list for <code>SigmaMarginal</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_stack_fa.html">postprocess_stack_fa</a></span><span class="op">(</span><span class="va">fit0</span>, S <span class="op">=</span> <span class="va">S</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">post0</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a3--select-k-and-refit">A3. Select K and refit<a class="anchor" aria-label="anchor" href="#a3--select-k-and-refit"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/select_k_stack_fa.html">select_k_stack_fa</a></span><span class="op">(</span><span class="va">post0</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_stack_fa_2step.html">fit_stack_fa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  post_fit0 <span class="op">=</span> <span class="va">post0</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a4--fit-two-step-stack-fa-in-one-call">A4. Fit two-step Stack FA in one call<a class="anchor" aria-label="anchor" href="#a4--fit-two-step-stack-fa-in-one-call"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_stack_fa_2step.html">fit_stack_fa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">4</span>,<span class="co"># Overspecified</span></span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>  </span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-b-ind-fa-msfa-backend">Method B: Ind FA (MSFA backend)<a class="anchor" aria-label="anchor" href="#method-b-ind-fa-msfa-backend"></a>
</h2>
<p>“Ind FA” fits separate factor models per study.</p>
<div class="section level3">
<h3 id="b1--fit">B1. Fit<a class="anchor" aria-label="anchor" href="#b1--fit"></a>
</h3>
<p>You specify <code>j_s</code> as either: - a single integer (recycled
to all studies), or - a length-<code>S</code> integer vector.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ind_fa.html">fit_ind_fa</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  j_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">S</span><span class="op">)</span>,</span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="b2--post-process-select-j_s-refit">B2. Post-process, select J_s, refit<a class="anchor" aria-label="anchor" href="#b2--post-process-select-j_s-refit"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_ind_fa.html">postprocess_ind_fa</a></span><span class="op">(</span><span class="va">fit0</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/select_js_ind_fa.html">select_js_ind_fa</a></span><span class="op">(</span><span class="va">post0</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ind_fa_2step.html">fit_ind_fa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  post_fit0 <span class="op">=</span> <span class="va">post0</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="b3--fit-two-step-ind-fa-in-one-call">B3. Fit two-step Ind FA in one call<a class="anchor" aria-label="anchor" href="#b3--fit-two-step-ind-fa-in-one-call"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ind_fa_2step.html">fit_ind_fa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  j_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">S</span><span class="op">)</span>,</span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-c-pfa-script-backend">Method C: PFA (script backend)<a class="anchor" aria-label="anchor" href="#method-c-pfa-script-backend"></a>
</h2>
<p>PFA scripts are bundled in <code>inst/extdata/pfa/</code>. The
wrapper: 1) loads the backend via <code>load_backend("pfa")</code><br>
2) centers/scales each study (defaults <code>center=TRUE</code>,
<code>scale=FALSE</code>)<br>
3) stacks into one matrix <code>X</code> and builds the study id vector
<code>b</code><br>
4) calls the backend <code>PFA(X = X, b = b, k = ..., ...)</code></p>
<div class="section level3">
<h3 id="c1--fit">C1. Fit<a class="anchor" aria-label="anchor" href="#c1--fit"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_pfa.html">fit_pfa</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">6</span>, <span class="co"># Overspecified</span></span>
<span>  center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nrun <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  burn <span class="op">=</span> <span class="fl">500</span></span>
<span>  <span class="co"># other backend parameters via ...</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="c2--post-process-and-select-k">C2. Post-process and select K<a class="anchor" aria-label="anchor" href="#c2--post-process-and-select-k"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_pfa.html">postprocess_pfa</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/select_k_pfa.html">select_k_pfa</a></span><span class="op">(</span><span class="va">post</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-d-mom-ss-bfr-be-backend">Method D: MOM-SS (BFR.BE backend)<a class="anchor" aria-label="anchor" href="#method-d-mom-ss-bfr-be-backend"></a>
</h2>
<p>MOM-SS uses the <code>BFR.BE</code> backend and requires: -
<code>q</code> (aka <code>k</code>): number of shared factors - optional
covariates <code>X</code> (passed to the backend as <code>v</code>)</p>
<p><strong>In this package wrapper</strong>, if you pass
<code>Y_list</code>, the wrapper stacks it into <code>x</code>, builds
the <strong>membership matrix</strong> <code>b</code>, and forwards
<code>q</code> and <code>v</code>.</p>
<div class="section level3">
<h3 id="d1--prepare-covariates-optional">D1. Prepare covariates (optional)<a class="anchor" aria-label="anchor" href="#d1--prepare-covariates-optional"></a>
</h3>
<p><code>X</code> can be either: - a single matrix with
<code>sum(nrow(Y_list))</code> rows, or - a list of matrices aligned to
<code>Y_list</code> (which will be stacked).</p>
<p>Example: two synthetic covariates per subject:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">Y_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="d2--fit-and-post-process">D2. Fit and post-process<a class="anchor" aria-label="anchor" href="#d2--fit-and-post-process"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_momss.html">fit_momss</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">6</span>,      </span>
<span>  X <span class="op">=</span> <span class="va">X_list</span>, <span class="co"># optional</span></span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_momss.html">postprocess_momss</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">post</span><span class="op">)</span></span>
<span><span class="co"># post$SigmaPhi, post$Psi, post$alpha, post$B, post$SigmaMarginal</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-e-sufa-sufa-backend">Method E: SUFA (SUFA backend)<a class="anchor" aria-label="anchor" href="#method-e-sufa-sufa-backend"></a>
</h2>
<p>In the tutorial workflow, we typically: - center within each study
(<code>center = TRUE</code>) - do not rescale variances
(<code>scale = FALSE</code>) - specify <code>qmax</code> and
<code>nrun</code></p>
<div class="section level3">
<h3 id="e1--fit-and-post-process">E1. Fit and post-process<a class="anchor" aria-label="anchor" href="#e1--fit-and-post-process"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install_backend("sufa")</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_sufa.html">fit_sufa</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">6</span>,      <span class="co"># or kmax = 6 depending on your wrapper</span></span>
<span>  nrun <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_sufa.html">postprocess_sufa</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">post</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-f-bmsfa-msfa-backend">Method F: BMSFA (MSFA backend)<a class="anchor" aria-label="anchor" href="#method-f-bmsfa-msfa-backend"></a>
</h2>
<div class="section level3">
<h3 id="f1--fit">F1. Fit<a class="anchor" aria-label="anchor" href="#f1--fit"></a>
</h3>
<p>You specify: - <code>k</code>: number of shared factors -
<code>j_s</code>: number of study-specific factors (length
<code>S</code>)</p>
<p>You can control MCMC via
<code>control = list(nrun = ..., burn = ...)</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_bmsfa.html">fit_bmsfa</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>, <span class="co"># Overspecified</span></span>
<span>  j_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">S</span><span class="op">)</span>,</span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">2000</span>, burn <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="f2--post-process">F2. Post-process<a class="anchor" aria-label="anchor" href="#f2--post-process"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_bmsfa.html">postprocess_bmsfa</a></span><span class="op">(</span><span class="va">fit0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">post0</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="f3--select-dimensions-and-refit">F3. Select dimensions and refit<a class="anchor" aria-label="anchor" href="#f3--select-dimensions-and-refit"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/select_k_bmsfa.html">select_k_bmsfa</a></span><span class="op">(</span><span class="va">post0</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/select_js_bmsfa.html">select_js_bmsfa</a></span><span class="op">(</span><span class="va">post0</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># refit</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_bmsfa_2step.html">fit_bmsfa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  post_fit0 <span class="op">=</span> <span class="va">post0</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Or `fit_bmsfa` with the selected k and j_s, and `postprocess` again.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="f4--fit-two-step-bmsfa-in-one-call">F4. Fit two-step BMSFA in one call<a class="anchor" aria-label="anchor" href="#f4--fit-two-step-bmsfa-in-one-call"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_bmsfa_2step.html">fit_bmsfa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>, <span class="co"># Overspecified</span></span>
<span>  j_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">S</span><span class="op">)</span>,</span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-g-cavi-vi-msfa-backend">Method G: CAVI (VI-MSFA backend)<a class="anchor" aria-label="anchor" href="#method-g-cavi-vi-msfa-backend"></a>
</h2>
<p>CAVI is a variational inference algorithm for multi-study factor
analysis implemented in the GitHub repo <code>blhansen/VI-MSFA</code> (R
package name: <code>VIMSFA</code>).</p>
<p><strong>What you need</strong> - <code>Y_list</code>: a list of S
matrices, each <code>n_s × P</code>, where all studies share the same
variables (same <code>P</code> and column order). - <code>k</code>
(<code>K</code> in VI-MSFA): number of common factors. -
<code>j_s</code> (<code>J_s</code> in VI-MSFA): study-specific factor
counts (either a scalar or a length-S vector). - Preprocessing: this
project typically <strong>centers only</strong>
(<code>center=TRUE, scale=FALSE</code>) to match other methods.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install the backend once (downloads / installs VIMSFA from GitHub)</span></span>
<span><span class="fu">bmfaToolkits</span><span class="fu">::</span><span class="fu"><a href="../reference/install_backend.html">install_backend</a></span><span class="op">(</span><span class="st">"cavi"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Y_list</span> <span class="op">&lt;-</span> <span class="va">toy</span><span class="op">$</span><span class="va">Y_list</span></span>
<span></span>
<span><span class="va">fit_cavi</span> <span class="op">&lt;-</span> <span class="fu">bmfaToolkits</span><span class="fu">::</span><span class="fu"><a href="../reference/fit_cavi.html">fit_cavi</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k      <span class="op">=</span> <span class="fl">3</span>,                 <span class="co"># common factors</span></span>
<span>  j_s    <span class="op">=</span> <span class="fl">2</span>,                 <span class="co"># study-specific factors (scalar -&gt; recycled to length S)</span></span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling   <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">post_cavi</span> <span class="op">&lt;-</span> <span class="fu">bmfaToolkits</span><span class="fu">::</span><span class="fu"><a href="../reference/post_CAVI.html">postprocess_cavi</a></span><span class="op">(</span><span class="va">fit_cavi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">post_cavi</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><strong>What <code><a href="../reference/post_CAVI.html">postprocess_cavi()</a></code> does behind the
scenes</strong></p>
<p><code><a href="https://rdrr.io/pkg/VIMSFA/man/cavi_msfa.html" class="external-link">VIMSFA::cavi_msfa()</a></code> returns posterior means: -
<code>mean_phi</code> (P × K): common loading matrix Φ -
<code>mean_lambda_s</code> (list of P × J_s): study-specific loading
matrices Λ_s - <code>mean_psi_s</code> (list of length-P): residual
variances ψ_s</p>
<p><code><a href="../reference/post_CAVI.html">bmfaToolkits::post_CAVI()</a></code>/<code><a href="../reference/post_CAVI.html">postprocess_cavi()</a></code>
converts these into the standardized outputs used throughout this
package: - <code>SigmaPhi = Φ Φᵀ</code> -
<code>SigmaLambdaList[[s]] = Λ_s Λ_sᵀ</code> -
<code>SigmaMarginal[[s]] = SigmaPhi + SigmaLambdaList[[s]] + diag(ψ_s)</code></p>
<div class="section level4">
<h4 id="automatic-factor-selection-and-refit-2-step">Automatic factor selection and refit (2-step)<a class="anchor" aria-label="anchor" href="#automatic-factor-selection-and-refit-2-step"></a>
</h4>
<p>Like BMSFA in this package, CAVI can be run in a
<strong>2-step</strong> workflow:</p>
<ol style="list-style-type: decimal">
<li>Fit an initial (often over-specified) model with
<code>(k, j_s)</code>.</li>
<li>Post-process to get <code>SigmaPhi</code> and each
<code>SigmaLambda_s</code>.</li>
<li>Select <code>K</code> and <code>J_s</code> using the
eigen-proportion rule (<code>cutoff</code>).</li>
<li>Refit with the selected factor counts.</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: initial fit (choose generous k / j_s)</span></span>
<span><span class="va">fit0</span>  <span class="op">&lt;-</span> <span class="fu">bmfaToolkits</span><span class="fu">::</span><span class="fu"><a href="../reference/fit_cavi.html">fit_cavi</a></span><span class="op">(</span><span class="va">Y_list</span>, k <span class="op">=</span> <span class="fl">8</span>, j_s <span class="op">=</span> <span class="fl">6</span>, centering <span class="op">=</span> <span class="cn">TRUE</span>, scaling <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">post0</span> <span class="op">&lt;-</span> <span class="fu">bmfaToolkits</span><span class="fu">::</span><span class="fu"><a href="../reference/post_CAVI.html">postprocess_cavi</a></span><span class="op">(</span><span class="va">fit0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: refit using selected K and J_s</span></span>
<span><span class="va">post2</span> <span class="op">&lt;-</span> <span class="fu">bmfaToolkits</span><span class="fu">::</span><span class="fu"><a href="../reference/refit_cavi.html">refit_cavi</a></span><span class="op">(</span><span class="va">Y_list</span>, post_fit0 <span class="op">=</span> <span class="va">post0</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                                  centering <span class="op">=</span> <span class="cn">TRUE</span>, scaling <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or: do both in one call</span></span>
<span><span class="va">post2_alt</span> <span class="op">&lt;-</span> <span class="fu">bmfaToolkits</span><span class="fu">::</span><span class="fu"><a href="../reference/fit_cavi_2step.html">fit_cavi_2step</a></span><span class="op">(</span><span class="va">Y_list</span>, k <span class="op">=</span> <span class="fl">8</span>, j_s <span class="op">=</span> <span class="fl">6</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                                         centering <span class="op">=</span> <span class="cn">TRUE</span>, scaling <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="method-h--blast-script-backend">Method H. BLAST (script backend)<a class="anchor" aria-label="anchor" href="#method-h--blast-script-backend"></a>
</h2>
<p>BLAST is implemented as a research-code repository (not a
CRAN/Bioconductor package) in: <code>maurilorenzo/BLAST</code>.</p>
<p>In this package we treat BLAST as a <strong>script backend</strong>
(like PFA/Tetris):</p>
<ul>
<li>When developing from source: put the BLAST scripts under
<code>inst/extdata/blast/</code>.</li>
<li>After installation: they are available under
<code>system.file("extdata","blast", package="bmfaToolkits")</code>.</li>
</ul>
<p><code><a href="../reference/fit_blast.html">fit_blast()</a></code> loads the scripts via
<code>load_backend("blast")</code>.</p>
<p><strong>What you need</strong> - <code>Y_list</code>: a list of S
matrices, each <code>n_s × P</code> (same P across studies). -
<code>k</code>: number of common factors. - <code>q_s</code>:
study-specific factor counts (scalar or length S). - Important BLAST
args in this project: - <code>n_MC</code>: Monte Carlo iterations (e.g.,
10000). - <code>sample_outer_product</code>: if <code>FALSE</code>,
BLAST requires <code>subsample_index</code> (we default to
<code>1:min(100, P)</code>).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Y_list</span> <span class="op">&lt;-</span> <span class="va">toy</span><span class="op">$</span><span class="va">Y_list</span></span>
<span></span>
<span><span class="va">fit_blast</span> <span class="op">&lt;-</span> <span class="fu">bmfaToolkits</span><span class="fu">::</span><span class="fu"><a href="../reference/fit_blast.html">fit_blast</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k      <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  q_s    <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  n_MC   <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale  <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sample_outer_product <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="co"># subsample_index defaults to 1:min(100, P) when sample_outer_product = FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">post_blast</span> <span class="op">&lt;-</span> <span class="fu">bmfaToolkits</span><span class="fu">::</span><span class="fu"><a href="../reference/post_BLAST.html">postprocess_blast</a></span><span class="op">(</span><span class="va">fit_blast</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">post_blast</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><strong>What <code><a href="../reference/post_BLAST.html">postprocess_blast()</a></code> does behind the
scenes</strong></p>
<p>BLAST’s fit object is a list whose fields may vary depending on
settings. <code><a href="../reference/post_BLAST.html">bmfaToolkits::post_BLAST()</a></code> attempts to extract: -
<code>Lambda_mean</code> (P × K) as <code>Phi</code> -
<code>Lambda_outer_mean</code> (P × P) as <code>SigmaPhi</code> if
present; otherwise compute <code>Phi Phiᵀ</code> -
<code>Gammas_mean</code> (P × q × S) and/or
<code>Gammas_outer_mean</code> (P × P × S) for study-specific components
- <code>Sigma_2s_samples</code> (N_mc × P) for residual variances (ψ);
if absent, residual variances are returned as <code>NA</code></p>
<p>It then returns the standardized pieces (<code>Phi</code>,
<code>SigmaPhi</code>, <code>LambdaList</code>,
<code>SigmaLambdaList</code>, <code>PsiList</code>,
<code>SigmaMarginal</code>) so BLAST can plug into the same downstream
code as other methods.</p>
<hr>
</div>
<div class="section level2">
<h2 id="method-i-tetris-script-backend">Method I: Tetris (script backend)<a class="anchor" aria-label="anchor" href="#method-i-tetris-script-backend"></a>
</h2>
<p>Tetris scripts are bundled in <code>inst/extdata/tetris/</code>.</p>
<p>The “3-step” workflow from the tutorial is:</p>
<ol style="list-style-type: decimal">
<li>initial run: <code>tetris(..., fixed_bigT = FALSE)</code><br>
</li>
<li>select <code>big_T</code>:
<code>choose.A(fit, alpha_IBP = alpha, S = S)</code><br>
</li>
<li>fixed run:
<code>tetris(..., fixed_bigT = TRUE, bigT = big_T)</code>
</li>
</ol>
<div class="section level3">
<h3 id="i1--manual-3-step-pipeline">I1. Manual 3-step pipeline<a class="anchor" aria-label="anchor" href="#i1--manual-3-step-pipeline"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_tetris.html">fit_tetris</a></span><span class="op">(</span><span class="va">Y_list</span>, alpha <span class="op">=</span> <span class="st">"auto"</span>, beta <span class="op">=</span> <span class="fl">1</span>, fixed_bigT <span class="op">=</span> <span class="cn">FALSE</span>, nrun <span class="op">=</span> <span class="fl">500</span>, burn <span class="op">=</span> <span class="fl">200</span>, nprint <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># Reduced iterations a faster runtime</span></span>
<span><span class="va">big_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_T_tetris.html">select_T_tetris</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span>  <span class="co"># passes alpha_IBP and S from fit1 metadata by default</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_tetris.html">fit_tetris</a></span><span class="op">(</span><span class="va">Y_list</span>, alpha <span class="op">=</span> <span class="va">fit1</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">alpha</span>, beta <span class="op">=</span> <span class="fl">1</span>, fixed_bigT <span class="op">=</span> <span class="cn">TRUE</span>, bigT <span class="op">=</span> <span class="va">big_T</span>,</span>
<span>                   nrun <span class="op">=</span> <span class="fl">500</span>, burn <span class="op">=</span> <span class="fl">200</span>, nprint <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_tetris.html">postprocess_tetris</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="i2--one-shot-pipeline-recommended">I2. One-shot pipeline (recommended)<a class="anchor" aria-label="anchor" href="#i2--one-shot-pipeline-recommended"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_tetris_2step.html">fit_tetris_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  alpha <span class="op">=</span> <span class="st">"auto"</span>,   <span class="co"># ceiling(1.25 * S)</span></span>
<span>  beta <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  nrun <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  burn <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  nprint <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="invoke-any-method-fit_integrative_fa">Invoke any method: fit_integrative_fa()<a class="anchor" aria-label="anchor" href="#invoke-any-method-fit_integrative_fa"></a>
</h2>
<ul>
<li><code>fit_integrative_fa(method = "bmsfa"|"momss"|..., ...)</code></li>
<li><code>postprocess_integrative_fa(method = ..., fit)</code></li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_integrative_fa.html">fit_integrative_fa</a></span><span class="op">(</span><span class="st">"bmsfa"</span>, Y_list <span class="op">=</span> <span class="va">Y_list</span>, k <span class="op">=</span> <span class="fl">4</span>, j_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_integrative_fa.html">postprocess_integrative_fa</a></span><span class="op">(</span><span class="st">"bmsfa"</span>, <span class="va">fit</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visuallization">Visuallization<a class="anchor" aria-label="anchor" href="#visuallization"></a>
</h2>
<p>This function give a nice heatmap plot for the loadings</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_single_loadings.html">plot_single_loadings</a></span><span class="op">(</span>mat <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">Phi</span>, fill_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Displays grey if values are out of range</span></span></code></pre></div>
<hr>
<div class="section level3">
<h3 id="practical-tips">Practical tips<a class="anchor" aria-label="anchor" href="#practical-tips"></a>
</h3>
<ul>
<li>Start with <strong>short runs</strong>
(<code>nrun</code>/<code>burn</code>) to validate your pipeline, then
increase.</li>
<li>Always check that each study has the same <code>P</code> (number of
columns).</li>
<li>For methods with rotational ambiguity, rely on the package
post-processing (e.g., OP alignment) before comparing loadings.</li>
</ul>
</div>
<div class="section level3">
<h3 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mavis Liang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
