<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>bifaToolkits package: toy-data workflows for each method • bifaToolkits</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="bifaToolkits package: toy-data workflows for each method">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bifaToolkits</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/toy_workflows.html">bifaToolkits package: toy-data workflows for each method</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Mavis-Liang/bifaToolkits/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>bifaToolkits package: toy-data workflows for each method</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Mavis-Liang/bifaToolkits/blob/HEAD/vignettes/toy_workflows.Rmd" class="external-link"><code>vignettes/toy_workflows.Rmd</code></a></small>
      <div class="d-none name"><code>toy_workflows.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="install-load">0. Install / load<a class="anchor" aria-label="anchor" href="#install-load"></a>
</h3>
<p>Many methods are implemented in <strong>optional backends</strong>
(GitHub/Bioconductor packages, or bundled scripts).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="co"># remotes::install_local("path/to/bifaToolkits")  # or install from your repo</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Mavis-Liang/bifaToolkits" class="external-link">bifaToolkits</a></span><span class="op">)</span></span></code></pre></div>
<p>Check what you can run on your machine:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Mavis-Liang/bifaToolkits" class="external-link">bifaToolkits</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/available_backends.html">available_backends</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;           backend           requires available</span></span>
<span><span class="co">#&gt; 1           bmsfa               MSFA      TRUE</span></span>
<span><span class="co">#&gt; 2        stack_fa               MSFA      TRUE</span></span>
<span><span class="co">#&gt; 3          ind_fa               MSFA      TRUE</span></span>
<span><span class="co">#&gt; 4           momss             BFR.BE      TRUE</span></span>
<span><span class="co">#&gt; 5            sufa               SUFA      TRUE</span></span>
<span><span class="co">#&gt; 6             pfa            scripts      TRUE</span></span>
<span><span class="co">#&gt; 7          tetris            scripts      TRUE</span></span>
<span><span class="co">#&gt; 8 curated_ovarian curatedOvarianData     FALSE</span></span>
<span><span class="co">#&gt;                                         hint</span></span>
<span><span class="co">#&gt; 1     bifaToolkits::install_backend("bmsfa")</span></span>
<span><span class="co">#&gt; 2  bifaToolkits::install_backend("stack_fa")</span></span>
<span><span class="co">#&gt; 3    bifaToolkits::install_backend("ind_fa")</span></span>
<span><span class="co">#&gt; 4     bifaToolkits::install_backend("momss")</span></span>
<span><span class="co">#&gt; 5      bifaToolkits::install_backend("sufa")</span></span>
<span><span class="co">#&gt; 6     Bundled in package under inst/extdata/</span></span>
<span><span class="co">#&gt; 7     Bundled in package under inst/extdata/</span></span>
<span><span class="co">#&gt; 8 BiocManager::install("curatedOvarianData")</span></span></code></pre></div>
<p>If you need an optional backend (and it is unavailable above),
install it via:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/install_backend.html">install_backend</a></span><span class="op">(</span><span class="st">"bmsfa"</span><span class="op">)</span>        <span class="co"># installs MSFA from GitHub</span></span>
<span><span class="fu"><a href="../reference/install_backend.html">install_backend</a></span><span class="op">(</span><span class="st">"momss"</span><span class="op">)</span>        <span class="co"># installs BFR.BE + Bioc deps</span></span>
<span><span class="fu"><a href="../reference/install_backend.html">install_backend</a></span><span class="op">(</span><span class="st">"sufa"</span><span class="op">)</span>         <span class="co"># installs SUFA from GitHub (build_vignettes = FALSE)</span></span>
<span><span class="fu"><a href="../reference/install_backend.html">install_backend</a></span><span class="op">(</span><span class="st">"curated_ovarian"</span><span class="op">)</span></span></code></pre></div>
<p>and no need t <code>library</code> it after installing.</p>
<blockquote>
<p><strong>Note on MOM-SS/BFR.BE.</strong> We only support MOM-SS in
“BFR.BE” backend right now. If you want to run other method mentioned in
their paper, eg. Laplace-SS, please refer to their original
repository.</p>
</blockquote>
<blockquote>
<p><strong>Note on SUFA.</strong><br>
You need to install PROJ, sqlite3 and GDAL onto PATH. Several updates
should be done, for example, terra. These might be difficult.</p>
</blockquote>
<blockquote>
<p><strong>Note on BMSFA</strong> install_backend(“bmsfa”) installs the
MSFA package from Mavis’s GitHub, which allows user-input scaling and
centering options. The original MSFA package on CRAN does not have these
options.</p>
</blockquote>
<blockquote>
<p><strong>Note on script backends (PFA / Tetris).</strong><br>
In this package, PFA and Tetris are bundled under
<code>inst/extdata/pfa/</code> and
<code>inst/extdata/tetris/</code>.<br>
They are loaded on demand via <code>load_backend("pfa")</code> or
<code>load_backend("tetris")</code>. PFA may compile
<code>PFA.cpp</code>, which requires a working C++ toolchain.</p>
</blockquote>
<p><strong>If install_backend function does not work, you can always
install them yourself then run the bifaToolkits package.</strong></p>
</div>
<div class="section level3">
<h3 id="load-toy-data-shipped-in-the-package">1. Load toy data (shipped in the package)<a class="anchor" aria-label="anchor" href="#load-toy-data-shipped-in-the-package"></a>
</h3>
<p>The toy data live in <code>inst/extdata/toy.rds</code>. You can load
it using <code><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">toy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"toy.rds"</span>, package <span class="op">=</span> <span class="st">"bifaToolkits"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">toy</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 11</span></span>
<span><span class="co">#&gt;  $ Y_mat          : num [1:150, 1:20] -0.0519 2.1092 1.4448 -0.4867 -1.6286 ...</span></span>
<span><span class="co">#&gt;  $ Y_list         :List of 3</span></span>
<span><span class="co">#&gt;   ..$ : num [1:52, 1:20] -0.0519 2.1092 1.4448 -0.4867 -1.6286 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   ..$ : num [1:58, 1:20] 3.15 -1.33 3.33 0.73 -1.09 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   ..$ : num [1:40, 1:20] 0.323 0.451 -2.435 -1.283 2.428 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;  $ n_s            : int [1:3, 1] 52 58 40</span></span>
<span><span class="co">#&gt;  $ A              : num [1:150, 1:3] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ Phi            : num [1:20, 1:4] -1 -0.895 -0.789 -0.684 -0.579 ...</span></span>
<span><span class="co">#&gt;  $ SigmaPhi       : num [1:20, 1:20] 1.762 1.507 1.252 0.997 0.742 ...</span></span>
<span><span class="co">#&gt;  $ LambdaList     :List of 3</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1] -0.857 -0.718 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1] 0 0 0 0.866 0 ...</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1] 0.73 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ SigmaLambdaList:List of 3</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1:20] 0.735 0.616 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1:20] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1:20] 0.532 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ SigmaMarginal  :List of 3</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1:20] 2.813 2.123 1.252 0.997 0.742 ...</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1:20] 2.118 1.507 1.252 0.997 0.742 ...</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1:20] 2.59 1.507 1.252 0.997 0.742 ...</span></span>
<span><span class="co">#&gt;  $ Psi_list       :List of 3</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1:20] 0.316 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1:20] 0.356 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ : num [1:20, 1:20] 0.296 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ Psi_mat        : num [1:20, 1:3] 0.316 0.356 0.914 0.274 0.433 ...</span></span></code></pre></div>
<p>The package wrappers expect <code>Y_list</code>: a list of study
matrices with the same number of columns (variables).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Y_list</span> <span class="op">&lt;-</span> <span class="va">toy</span><span class="op">$</span><span class="va">Y_list</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y_list</span><span class="op">)</span></span>
<span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="va">S</span>, P <span class="op">=</span> <span class="va">P</span><span class="op">)</span></span>
<span><span class="co">#&gt;  S  P </span></span>
<span><span class="co">#&gt;  3 20</span></span></code></pre></div>
<p>Throughout this vignette: - <code>S</code> = number of studies -
<code>P</code> = number of variables</p>
</div>
<div class="section level3">
<h3 id="common-post-processing-outputs">2. Common post-processing outputs<a class="anchor" aria-label="anchor" href="#common-post-processing-outputs"></a>
</h3>
<p>Each <code>postprocess_*()</code> function returns a list of
covariance components used in the tutorial:</p>
<ul>
<li>
<code>Phi</code> / <code>SigmaPhi</code>: shared loadings / shared
covariance</li>
<li>
<code>LambdaList</code> / <code>SigmaLambdaList</code>:
study-specific loadings / covariances (if the method has them)</li>
<li>
<code>Psi</code> or <code>PsiList</code>: diagonal residual
variances</li>
<li>
<code>SigmaMarginal</code>: per-study marginal covariance (shared +
specific + residual)</li>
</ul>
<p>The selection helpers choose dimensions using an <strong>eigenvalue
proportion rule</strong> (see <code><a href="../reference/select_k_from_sigma.html">select_k_from_sigma()</a></code>), and
the <code>refit_*()</code> helpers wrap the “initial fit → select dims →
refit” workflow.</p>
<hr>
</div>
<div class="section level2">
<h2 id="method-a-bmsfa-msfa-backend">Method A: BMSFA (MSFA backend)<a class="anchor" aria-label="anchor" href="#method-a-bmsfa-msfa-backend"></a>
</h2>
<div class="section level3">
<h3 id="a1--fit">A1. Fit<a class="anchor" aria-label="anchor" href="#a1--fit"></a>
</h3>
<p>You specify: - <code>k</code>: number of shared factors -
<code>j_s</code>: number of study-specific factors (length
<code>S</code>)</p>
<p>You can control MCMC via
<code>control = list(nrun = ..., burn = ...)</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_bmsfa.html">fit_bmsfa</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>, <span class="co"># Overspecified</span></span>
<span>  j_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">S</span><span class="op">)</span>,</span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; r= 1000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a2--post-process">A2. Post-process<a class="anchor" aria-label="anchor" href="#a2--post-process"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_bmsfa.html">postprocess_bmsfa</a></span><span class="op">(</span><span class="va">fit0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">post0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Phi"             "SigmaPhi"        "LambdaList"      "SigmaLambdaList"</span></span>
<span><span class="co">#&gt; [5] "PsiList"         "SigmaMarginal"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a3--select-dimensions-and-refit">A3. Select dimensions and refit<a class="anchor" aria-label="anchor" href="#a3--select-dimensions-and-refit"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/select_k_bmsfa.html">select_k_bmsfa</a></span><span class="op">(</span><span class="va">post0</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="fu"><a href="../reference/select_js_bmsfa.html">select_js_bmsfa</a></span><span class="op">(</span><span class="va">post0</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span></span>
<span><span class="co"># refit</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_bmsfa_2step.html">fit_bmsfa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  post_fit0 <span class="op">=</span> <span class="va">post0</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Selected K = 4</span></span>
<span><span class="co">#&gt; Selected j_s = c(1, 2, 2)</span></span>
<span><span class="co">#&gt; r= 1000</span></span>
<span><span class="co"># Or `fit_bmsfa` with the selected k and j_s, and `postprocess` again.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a4--fit-two-step-bmsfa-in-one-call">A4. Fit two-step BMSFA in one call<a class="anchor" aria-label="anchor" href="#a4--fit-two-step-bmsfa-in-one-call"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_bmsfa_2step.html">fit_bmsfa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>, <span class="co"># Overspecified</span></span>
<span>  j_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">S</span><span class="op">)</span>,</span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; r= 1000</span></span>
<span><span class="co">#&gt; Selected K = 4</span></span>
<span><span class="co">#&gt; Selected j_s = c(2, 2, 2)</span></span>
<span><span class="co">#&gt; r= 1000</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-b-stack-fa-msfa-backend">Method B: Stack FA (MSFA backend)<a class="anchor" aria-label="anchor" href="#method-b-stack-fa-msfa-backend"></a>
</h2>
<p>“Stack FA” stacks all studies and fits a single factor model.</p>
<div class="section level3">
<h3 id="b1--fit">B1. Fit<a class="anchor" aria-label="anchor" href="#b1--fit"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_stack_fa.html">fit_stack_fa</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>, <span class="co"># Overspecified</span></span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="b2--post-process">B2. Post-process<a class="anchor" aria-label="anchor" href="#b2--post-process"></a>
</h3>
<p><code><a href="../reference/postprocess_stack_fa.html">postprocess_stack_fa()</a></code> takes <code>S</code> so it can
return a per-study list for <code>SigmaMarginal</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_stack_fa.html">postprocess_stack_fa</a></span><span class="op">(</span><span class="va">fit0</span>, S <span class="op">=</span> <span class="va">S</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">post0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Phi"           "SigmaPhi"      "Psi"           "SigmaMarginal"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="b3--select-k-and-refit">B3. Select K and refit<a class="anchor" aria-label="anchor" href="#b3--select-k-and-refit"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/select_k_stack_fa.html">select_k_stack_fa</a></span><span class="op">(</span><span class="va">post0</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_stack_fa_2step.html">fit_stack_fa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  post_fit0 <span class="op">=</span> <span class="va">post0</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Selected K = 4</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="b4--fit-two-step-stack-fa-in-one-call">B4. Fit two-step Stack FA in one call<a class="anchor" aria-label="anchor" href="#b4--fit-two-step-stack-fa-in-one-call"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_stack_fa_2step.html">fit_stack_fa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">4</span>,<span class="co"># Overspecified</span></span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>  </span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; Selected K = 4</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-c-ind-fa-msfa-backend">Method C: Ind FA (MSFA backend)<a class="anchor" aria-label="anchor" href="#method-c-ind-fa-msfa-backend"></a>
</h2>
<p>“Ind FA” fits separate factor models per study.</p>
<div class="section level3">
<h3 id="c1--fit">C1. Fit<a class="anchor" aria-label="anchor" href="#c1--fit"></a>
</h3>
<p>You specify <code>j_s</code> as either: - a single integer (recycled
to all studies), or - a length-<code>S</code> integer vector.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ind_fa.html">fit_ind_fa</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  j_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">S</span><span class="op">)</span>,</span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="c2--post-process-select-j_s-refit">C2. Post-process, select J_s, refit<a class="anchor" aria-label="anchor" href="#c2--post-process-select-j_s-refit"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_ind_fa.html">postprocess_ind_fa</a></span><span class="op">(</span><span class="va">fit0</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/select_js_ind_fa.html">select_js_ind_fa</a></span><span class="op">(</span><span class="va">post0</span>, cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ind_fa_2step.html">fit_ind_fa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  post_fit0 <span class="op">=</span> <span class="va">post0</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Selected j_s = c(3, 3, 3)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="c3--fit-two-step-ind-fa-in-one-call">C3. Fit two-step Ind FA in one call<a class="anchor" aria-label="anchor" href="#c3--fit-two-step-ind-fa-in-one-call"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ind_fa_2step.html">fit_ind_fa_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  j_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">S</span><span class="op">)</span>,</span>
<span>  centering <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrun <span class="op">=</span> <span class="fl">1000</span>, burn <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; Selected j_s = c(3, 3, 3)</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; [1] 1000</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-d-mom-ss-bfr-be-backend">Method D: MOM-SS (BFR.BE backend)<a class="anchor" aria-label="anchor" href="#method-d-mom-ss-bfr-be-backend"></a>
</h2>
<p>MOM-SS uses the <code>BFR.BE</code> backend and requires: -
<code>q</code> (aka <code>k</code>): number of shared factors - optional
covariates <code>X</code> (passed to the backend as <code>v</code>)</p>
<p><strong>In this package wrapper</strong>, if you pass
<code>Y_list</code>, the wrapper stacks it into <code>x</code>, builds
the <strong>membership matrix</strong> <code>b</code>, and forwards
<code>q</code> and <code>v</code>.</p>
<div class="section level3">
<h3 id="d1--prepare-covariates-optional">D1. Prepare covariates (optional)<a class="anchor" aria-label="anchor" href="#d1--prepare-covariates-optional"></a>
</h3>
<p><code>X</code> can be either: - a single matrix with
<code>sum(nrow(Y_list))</code> rows, or - a list of matrices aligned to
<code>Y_list</code> (which will be stacked).</p>
<p>Example: two synthetic covariates per subject:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">Y_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="d2--fit-and-post-process">D2. Fit and post-process<a class="anchor" aria-label="anchor" href="#d2--fit-and-post-process"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_momss.html">fit_momss</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">6</span>,      </span>
<span>  X <span class="op">=</span> <span class="va">X_list</span>, <span class="co"># optional</span></span>
<span>  scaling <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CV varimax rotation"</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; [1] "CV no rotation"</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_momss.html">postprocess_momss</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">post</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Phi"           "SigmaPhi"      "Psi"           "alpha"        </span></span>
<span><span class="co">#&gt; [5] "B"             "SigmaMarginal"</span></span>
<span><span class="co"># post$SigmaPhi, post$Psi, post$alpha, post$B, post$SigmaMarginal</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-e-sufa-sufa-backend">Method E: SUFA (SUFA backend)<a class="anchor" aria-label="anchor" href="#method-e-sufa-sufa-backend"></a>
</h2>
<p>In the tutorial workflow, we typically: - center within each study
(<code>center = TRUE</code>) - do not rescale variances
(<code>scale = FALSE</code>) - specify <code>qmax</code> and
<code>nrun</code></p>
<div class="section level3">
<h3 id="e1--fit-and-post-process">E1. Fit and post-process<a class="anchor" aria-label="anchor" href="#e1--fit-and-post-process"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install_backend("sufa")</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_sufa.html">fit_sufa</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">6</span>,      <span class="co"># or kmax = 6 depending on your wrapper</span></span>
<span>  nrun <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_sufa.html">postprocess_sufa</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">post</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-f-pfa-script-backend">Method F: PFA (script backend)<a class="anchor" aria-label="anchor" href="#method-f-pfa-script-backend"></a>
</h2>
<p>PFA scripts are bundled in <code>inst/extdata/pfa/</code>. The
wrapper: 1) loads the backend via <code>load_backend("pfa")</code><br>
2) centers/scales each study (defaults <code>center=TRUE</code>,
<code>scale=FALSE</code>)<br>
3) stacks into one matrix <code>X</code> and builds the study id vector
<code>b</code><br>
4) calls the backend <code>PFA(X = X, b = b, k = ..., ...)</code></p>
<div class="section level3">
<h3 id="f1--fit">F1. Fit<a class="anchor" aria-label="anchor" href="#f1--fit"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_pfa.html">fit_pfa</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">6</span>, <span class="co"># Overspecified</span></span>
<span>  center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nrun <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  burn <span class="op">=</span> <span class="fl">500</span></span>
<span>  <span class="co"># other backend parameters via ...</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'pracma'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:psych':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     logit, polar</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:partitions':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     perms</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:LaplacesDemon':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     logit, loglog, Mode</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:Hmisc':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ceil</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:Matrix':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expm, lu, tril, triu</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:mgcv':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     magic</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:ncvreg':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     std</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'expm'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:pracma':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expm, logm, sqrtm</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:Matrix':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expm</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |==                                                                    |   4%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |=========                                                             |  14%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |================                                                      |  24%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |=======================                                               |  34%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |==============================                                        |  44%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |=====================================                                 |  54%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |============================================                          |  64%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |===================================================                   |  74%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |==========================================================            |  84%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |=================================================================     |  94%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="f2--post-process-and-select-k">F2. Post-process and select K<a class="anchor" aria-label="anchor" href="#f2--post-process-and-select-k"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_pfa.html">postprocess_pfa</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/select_k_pfa.html">select_k_pfa</a></span><span class="op">(</span><span class="va">post</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-g-tetris-script-backend">Method G: Tetris (script backend)<a class="anchor" aria-label="anchor" href="#method-g-tetris-script-backend"></a>
</h2>
<p>Tetris scripts are bundled in <code>inst/extdata/tetris/</code>.</p>
<p>The “3-step” workflow from the tutorial is:</p>
<ol style="list-style-type: decimal">
<li>initial run: <code>tetris(..., fixed_bigT = FALSE)</code><br>
</li>
<li>select <code>big_T</code>:
<code>choose.A(fit, alpha_IBP = alpha, S = S)</code><br>
</li>
<li>fixed run:
<code>tetris(..., fixed_bigT = TRUE, bigT = big_T)</code>
</li>
</ol>
<div class="section level3">
<h3 id="g1--manual-3-step-pipeline">G1. Manual 3-step pipeline<a class="anchor" aria-label="anchor" href="#g1--manual-3-step-pipeline"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_tetris.html">fit_tetris</a></span><span class="op">(</span><span class="va">Y_list</span>, alpha <span class="op">=</span> <span class="st">"auto"</span>, beta <span class="op">=</span> <span class="fl">1</span>, fixed_bigT <span class="op">=</span> <span class="cn">FALSE</span>, nrun <span class="op">=</span> <span class="fl">500</span>, burn <span class="op">=</span> <span class="fl">200</span>, nprint <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># Reduced iterations a faster runtime</span></span>
<span><span class="co">#&gt; iter= 100</span></span>
<span><span class="co">#&gt; iter= 200</span></span>
<span><span class="co">#&gt; iter= 300</span></span>
<span><span class="co">#&gt; iter= 400</span></span>
<span><span class="co">#&gt; iter= 500</span></span>
<span><span class="va">big_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_T_tetris.html">select_T_tetris</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span>  <span class="co"># passes alpha_IBP and S from fit1 metadata by default</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_tetris.html">fit_tetris</a></span><span class="op">(</span><span class="va">Y_list</span>, alpha <span class="op">=</span> <span class="va">fit1</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">alpha</span>, beta <span class="op">=</span> <span class="fl">1</span>, fixed_bigT <span class="op">=</span> <span class="cn">TRUE</span>, bigT <span class="op">=</span> <span class="va">big_T</span>,</span>
<span>                   nrun <span class="op">=</span> <span class="fl">500</span>, burn <span class="op">=</span> <span class="fl">200</span>, nprint <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; iter= 100 </span></span>
<span><span class="co">#&gt; iter= 200 </span></span>
<span><span class="co">#&gt; iter= 300 </span></span>
<span><span class="co">#&gt; iter= 400 </span></span>
<span><span class="co">#&gt; iter= 500</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_tetris.html">postprocess_tetris</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="g2--one-shot-pipeline-recommended">G2. One-shot pipeline (recommended)<a class="anchor" aria-label="anchor" href="#g2--one-shot-pipeline-recommended"></a>
</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_tetris_2step.html">fit_tetris_2step</a></span><span class="op">(</span></span>
<span>  Y_list <span class="op">=</span> <span class="va">Y_list</span>,</span>
<span>  alpha <span class="op">=</span> <span class="st">"auto"</span>,   <span class="co"># ceiling(1.25 * S)</span></span>
<span>  beta <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  nrun <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  burn <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  nprint <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; iter= 100</span></span>
<span><span class="co">#&gt; iter= 200</span></span>
<span><span class="co">#&gt; iter= 300</span></span>
<span><span class="co">#&gt; iter= 400</span></span>
<span><span class="co">#&gt; iter= 500 </span></span>
<span><span class="co">#&gt; iter= 100 </span></span>
<span><span class="co">#&gt; iter= 200 </span></span>
<span><span class="co">#&gt; iter= 300 </span></span>
<span><span class="co">#&gt; iter= 400 </span></span>
<span><span class="co">#&gt; iter= 500</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="method-h-one-call-dispatch-that-can-invoke-any-method">Method H: One-call dispatch that can invoke any method<a class="anchor" aria-label="anchor" href="#method-h-one-call-dispatch-that-can-invoke-any-method"></a>
</h2>
<ul>
<li><code>fit_integrative_fa(method = "bmsfa"|"momss"|..., ...)</code></li>
<li><code>postprocess_integrative_fa(method = ..., fit)</code></li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_integrative_fa.html">fit_integrative_fa</a></span><span class="op">(</span><span class="st">"bmsfa"</span>, Y_list <span class="op">=</span> <span class="va">Y_list</span>, k <span class="op">=</span> <span class="fl">4</span>, j_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">S</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; r= 1000 </span></span>
<span><span class="co">#&gt; r= 2000 </span></span>
<span><span class="co">#&gt; r= 3000</span></span>
<span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postprocess_integrative_fa.html">postprocess_integrative_fa</a></span><span class="op">(</span><span class="st">"bmsfa"</span>, <span class="va">fit</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visuallization">Visuallization<a class="anchor" aria-label="anchor" href="#visuallization"></a>
</h2>
<p>This function give a nice heatmap plot for the loadings</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_single_loadings.html">plot_single_loadings</a></span><span class="op">(</span>mat <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">Phi</span>, fill_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Displays grey if values are out of range</span></span></code></pre></div>
<p><img src="toy_workflows_files/figure-html/unnamed-chunk-25-1.png" class="r-plt" alt="Shared loading." width="700"></p>
<hr>
<div class="section level3">
<h3 id="practical-tips">Practical tips<a class="anchor" aria-label="anchor" href="#practical-tips"></a>
</h3>
<ul>
<li>Start with <strong>short runs</strong>
(<code>nrun</code>/<code>burn</code>) to validate your pipeline, then
increase.</li>
<li>Always check that each study has the same <code>P</code> (number of
columns).</li>
<li>For methods with rotational ambiguity, rely on the package
post-processing (e.g., OP alignment) before comparing loadings.</li>
</ul>
</div>
<div class="section level3">
<h3 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31 ucrt)</span></span>
<span><span class="co">#&gt; Platform: x86_64-w64-mingw32/x64</span></span>
<span><span class="co">#&gt; Running under: Windows 11 x64 (build 26200)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt;   LAPACK version 3.12.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] LC_COLLATE=English_United States.utf8 </span></span>
<span><span class="co">#&gt; [2] LC_CTYPE=English_United States.utf8   </span></span>
<span><span class="co">#&gt; [3] LC_MONETARY=English_United States.utf8</span></span>
<span><span class="co">#&gt; [4] LC_NUMERIC=C                          </span></span>
<span><span class="co">#&gt; [5] LC_TIME=English_United States.utf8    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: Asia/Shanghai</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] clue_0.3-66            matrixcalc_1.0-6       R.utils_2.13.0        </span></span>
<span><span class="co">#&gt;  [4] R.oo_1.27.1            R.methodsS3_1.8.2      combinat_0.0-8        </span></span>
<span><span class="co">#&gt;  [7] matlab_1.0.4.1         statmod_1.5.1          RcppArmadillo_15.2.3-1</span></span>
<span><span class="co">#&gt; [10] Rcpp_1.1.0             expm_1.0-0             pracma_2.4.6          </span></span>
<span><span class="co">#&gt; [13] MASS_7.3-65            reshape2_1.4.5         psych_2.5.6           </span></span>
<span><span class="co">#&gt; [16] partitions_1.10-9      nloptr_2.2.1           mnormt_2.1.1          </span></span>
<span><span class="co">#&gt; [19] LaplacesDemon_16.1.6   Hmisc_5.2-4            glmnet_4.1-10         </span></span>
<span><span class="co">#&gt; [22] ggplot2_4.0.1          Matrix_1.7-4           mgcv_1.9-3            </span></span>
<span><span class="co">#&gt; [25] nlme_3.1-168           ncvreg_3.16.0          mvtnorm_1.3-3         </span></span>
<span><span class="co">#&gt; [28] bifaToolkits_0.0.1    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] Rdpack_2.6.4             polynom_1.4-1            gridExtra_2.3           </span></span>
<span><span class="co">#&gt;  [4] rlang_1.1.6              magrittr_2.0.4           matrixStats_1.5.0       </span></span>
<span><span class="co">#&gt;  [7] compiler_4.5.2           systemfonts_1.3.1        vctrs_0.6.5             </span></span>
<span><span class="co">#&gt; [10] stringr_1.6.0            pkgconfig_2.0.3          shape_1.4.6.1           </span></span>
<span><span class="co">#&gt; [13] fastmap_1.2.0            backports_1.5.0          rmarkdown_2.30          </span></span>
<span><span class="co">#&gt; [16] ragg_1.5.0               xfun_0.55                cachem_1.1.0            </span></span>
<span><span class="co">#&gt; [19] jsonlite_2.0.0           gmp_0.7-5                parallel_4.5.2          </span></span>
<span><span class="co">#&gt; [22] cluster_2.1.8.1          R6_2.6.1                 bslib_0.9.0             </span></span>
<span><span class="co">#&gt; [25] stringi_1.8.7            RColorBrewer_1.1-3       rrcov_1.7-7             </span></span>
<span><span class="co">#&gt; [28] rpart_4.1.24             jquerylib_0.1.4          iterators_1.0.14        </span></span>
<span><span class="co">#&gt; [31] knitr_1.50               base64enc_0.1-3          splines_4.5.2           </span></span>
<span><span class="co">#&gt; [34] nnet_7.3-20              tidyselect_1.2.1         rstudioapi_0.17.1       </span></span>
<span><span class="co">#&gt; [37] yaml_2.3.12              codetools_0.2-20         lattice_0.22-7          </span></span>
<span><span class="co">#&gt; [40] tibble_3.3.0             intervals_0.15.5         plyr_1.8.9              </span></span>
<span><span class="co">#&gt; [43] withr_3.0.2              S7_0.2.1                 MSFA_0.86               </span></span>
<span><span class="co">#&gt; [46] evaluate_1.0.5           SUFA_2.2.0               foreign_0.8-90          </span></span>
<span><span class="co">#&gt; [49] desc_1.4.3               survival_3.8-3           mclust_6.1.2            </span></span>
<span><span class="co">#&gt; [52] pillar_1.11.1            MatrixGenerics_1.22.0    checkmate_2.3.3         </span></span>
<span><span class="co">#&gt; [55] foreach_1.5.2            stats4_4.5.2             pcaPP_2.0-5             </span></span>
<span><span class="co">#&gt; [58] generics_0.1.4           mombf_3.5.4              sparseMatrixStats_1.22.0</span></span>
<span><span class="co">#&gt; [61] scales_1.4.0             robust_0.7-5             glue_1.8.0              </span></span>
<span><span class="co">#&gt; [64] tools_4.5.2              robustbase_0.99-6        data.table_1.17.8       </span></span>
<span><span class="co">#&gt; [67] BFR.BE_0.1.0             fs_1.6.6                 grid_4.5.2              </span></span>
<span><span class="co">#&gt; [70] rbibutils_2.4            colorspace_2.1-2         fit.models_0.64         </span></span>
<span><span class="co">#&gt; [73] htmlTable_2.4.3          latex2exp_0.9.6          Formula_1.2-5           </span></span>
<span><span class="co">#&gt; [76] cli_3.6.5                textshaping_1.0.4        dplyr_1.1.4             </span></span>
<span><span class="co">#&gt; [79] glasso_1.11              gtable_0.3.6             DEoptimR_1.1-4          </span></span>
<span><span class="co">#&gt; [82] sass_0.4.10              digest_0.6.39            htmlwidgets_1.6.4       </span></span>
<span><span class="co">#&gt; [85] farver_2.1.2             htmltools_0.5.9          pkgdown_2.2.0           </span></span>
<span><span class="co">#&gt; [88] lifecycle_1.0.4</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mavis Liang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
